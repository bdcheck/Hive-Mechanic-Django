[{"model": "builder.game", "pk": 216, "fields": {"name": "My New Test Game", "slug": "my-new-test-game", "game_state": {}, "cards": [], "editors": [], "viewers": []}}, {"model": "builder.game", "pk": 217, "fields": {"name": "Empty ID Test", "slug": "empty-id-test", "game_state": {}, "cards": [31, 32, 33, 37, 38, 39, 40, 41, 42, 43, 34, 35, 36], "editors": [], "viewers": []}}, {"model": "builder.gameversion", "pk": 464, "fields": {"game": 217, "created": "2021-08-27T18:32:26.649Z", "definition": "[\n  {\n    \"type\": \"sequence\",\n    \"id\": \"new-sequence\",\n    \"name\": \"New Sequence\",\n    \"items\": [\n      {\n        \"name\": \"Hello World\",\n        \"context\": \"Start building your game here.\",\n        \"message\": \"Hello World\",\n        \"type\": \"send-message\",\n        \"id\": \"hello-world\"\n      }\n    ]\n  }\n]"}}, {"model": "builder.gameversion", "pk": 465, "fields": {"game": 217, "created": "2021-08-27T18:32:59.323Z", "definition": "{\n  \"sequences\": [\n    {\n      \"type\": \"sequence\",\n      \"id\": \"new-sequence\",\n      \"name\": \"Empty ID Test\",\n      \"items\": [\n        {\n          \"name\": \"Hello World\",\n          \"context\": \"Start building your game here.\",\n          \"message\": \"Hello World\",\n          \"type\": \"send-message\",\n          \"id\": \"hello-world\"\n        }\n      ]\n    }\n  ],\n  \"interrupts\": [],\n  \"name\": \"Empty ID Test\",\n  \"initial-card\": \"\"\n}"}}, {"model": "builder.gameversion", "pk": 466, "fields": {"game": 217, "created": "2021-08-27T18:34:11.343Z", "definition": "{\n  \"sequences\": [\n    {\n      \"type\": \"sequence\",\n      \"id\": \"new-sequence\",\n      \"name\": \"Empty ID Test\",\n      \"items\": [\n        {\n          \"name\": \"Hello World\",\n          \"context\": \"Start building your game here.\",\n          \"message\": \"Hello World\",\n          \"type\": \"send-message\",\n          \"id\": \"hello-world\",\n          \"next\": \"process-variable\"\n        },\n        {\n          \"name\": \"Process Variable\",\n          \"patterns\": [\n            {\n              \"action\": \"\",\n              \"pattern\": \"1\"\n            },\n            {\n              \"action\": \"\",\n              \"pattern\": \"2\"\n            }\n          ],\n          \"type\": \"process-variable\",\n          \"id\": \"process-variable\",\n          \"variable\": \"pattern-test\"\n        }\n      ]\n    }\n  ],\n  \"interrupts\": [],\n  \"name\": \"Empty ID Test\",\n  \"initial-card\": \"\"\n}"}}, {"model": "builder.gameversion", "pk": 467, "fields": {"game": 216, "created": "2021-08-27T19:24:17.631Z", "definition": "[\n  {\n    \"type\": \"sequence\",\n    \"id\": \"new-sequence\",\n    \"name\": \"New Sequence\",\n    \"items\": [\n      {\n        \"name\": \"Hello World\",\n        \"context\": \"Start building your game here.\",\n        \"message\": \"Hello World\",\n        \"type\": \"send-message\",\n        \"id\": \"hello-world\"\n      }\n    ]\n  }\n]"}}, {"model": "builder.gameversion", "pk": 468, "fields": {"game": 217, "created": "2021-08-27T22:04:33.802Z", "definition": "{\n  \"sequences\": [\n    {\n      \"type\": \"sequence\",\n      \"id\": \"new-sequence\",\n      \"name\": \"Empty ID Test\",\n      \"items\": [\n        {\n          \"name\": \"Hello World\",\n          \"context\": \"Start building your game here.\",\n          \"message\": \"Hello World\",\n          \"type\": \"send-message\",\n          \"id\": \"hello-world\",\n          \"next\": \"response-test-2\"\n        },\n        {\n          \"name\": \"Response Test\",\n          \"patterns\": [],\n          \"timeout\": {\n            \"duration\": 15,\n            \"units\": \"minute\",\n            \"action\": null\n          },\n          \"type\": \"process-response\",\n          \"id\": \"response-test\"\n        },\n        {\n          \"name\": \"Response Test\",\n          \"patterns\": [],\n          \"timeout\": {\n            \"duration\": 15,\n            \"units\": \"minute\",\n            \"action\": null\n          },\n          \"type\": \"process-response\",\n          \"id\": \"response-test-1\"\n        },\n        {\n          \"name\": \"Response Test\",\n          \"patterns\": [\n            {\n              \"pattern\": \"1\"\n            },\n            {\n              \"pattern\": \"2\"\n            }\n          ],\n          \"timeout\": {\n            \"duration\": 15,\n            \"units\": \"minute\",\n            \"action\": null\n          },\n          \"type\": \"process-response\",\n          \"id\": \"response-test-2\"\n        }\n      ]\n    }\n  ],\n  \"interrupts\": [],\n  \"name\": \"Empty ID Test\",\n  \"initial-card\": \"\"\n}"}}, {"model": "builder.interactioncard", "pk": 31, "fields": {"name": "Branching Card", "identifier": "branch", "description": null, "enabled": true, "evaluate_function": "import logging\nimport random\n\n# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n#      {\n#        \"name\": cardName,\n#        \"scope\": \"player\",\n#        \"mode\": \"random\",\n#        \"branches\": [{\n#           \"action\": \"node-1\",\n#           \"action\": \"node-2\",\n#           \"action\": \"node-3\"\n#        ],\n#        \"type\": \"branch\",\n#        \"id\": \"branch-12345\"\n#      },\n\nlogger = logging.getLogger('db')\n\nresult['details'] = {}\n\nresult['actions'] = []\nresult['next_id'] = None\n\nbranch_variable = 'branch-' + definition[\"id\"] + '-visits'\n\npast_branches = None\n\nif definition[\"scope\"] == \"player\":\n    past_branches = extras['player'].fetch_variable(branch_variable)\nelif definition[\"scope\"] == \"session\":\n    past_branches = extras['session'].fetch_variable(branch_variable)\nelse: # Game\n    past_branches = extras['session'].game_version.game.fetch_variable(branch_variable)\n\nif past_branches is None:\n    past_branches = ''\n\nvisits = []\n\nnext_index = 0\n\nif past_branches:\n    visits = past_branches.split(';')\n\nif definition[\"mode\"] == \"random\":\n    next_index = random.randint(0, len(definition[\"branches\"]) - 1) # nosec\nelif definition[\"mode\"] == \"random-no-repeat\":\n    options = list(range(0, len(definition[\"branches\"])))\n\n    for visit in sorted(visits, reverse=True):\n        if int(visit) < len(options):\n            del options[int(visit)]\n\n    if len(options) == 0: # pylint: disable=len-as-condition\n        options = range(0, len(definition[\"branches\"]))\n        visits = []\n\n    next_index = random.choice(options) # nosec\nelse: # Sequential\n    if len(visits) > 0: # pylint: disable=len-as-condition\n        next_index = len(visits) % len(definition[\"branches\"])\n    else:\n        next_index = 0\n\nvisits.append(str(next_index))\n\nnext_action = definition[\"branches\"][next_index][\"action\"]\n\nresult['details']['selected_index'] = next_index\nresult['details']['selected_action'] = next_action\nresult['details']['past_visits'] = visits\nresult['next_id'] = next_action\n\nif result['next_id'] is not None and ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n\naction = {\n    'type': 'set-variable',\n    'variable': branch_variable,\n    'value': ';'.join(visits)\n}\n\nif 'scope' in definition:\n    action['scope'] = definition['scope']\n\nresult['actions'] = [action]\n", "entry_actions": "go_on = {\n    'type': 'continue'\n}\n\nactions.append(go_on)\n", "client_implementation": "interaction_cards/branch_YJJ7qa8.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:02.047905+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"branch\",\n  \"name\": \"Branching Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"9eea4202a87de1ecceec77f6ebd3f64fc9c1f69250a22b19b30fc3c5da164ee091920342e57821dbc62dbb0265461146bae54007dd8f5f27eb5f63059fe5ce11\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/branch/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/branch/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/branch/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.830813+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/branch/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/branch/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/branch/client.js\",\n      \"sha512-hash\": \"eb16c00162178c6f30456be5e3c831e2554c496eeb16142b72c2b34beaa097132128c3849a798a526d29e752fcf892ae047eec40916f6ff41ad26dd8840bca62\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.830813+00:00\",\n      \"notes\": \"Code cleanup\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/branch/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/branch/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/branch/client.js\",\n      \"sha512-hash\": \"f40a31b73248b6c00f0de67041a2adac8114a1d092ed9a0bc7670f51d9e06a4f05c4f506c37c8caba7eb68504703c0c0fbb00ea4a6e4a993d4279e704d6718ad\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/branch/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/branch/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/branch/client.js\",\n      \"sha512-hash\": \"b4f5a8c89f73f3420116ade0397d38ca5ac1328d923e0e55961c1d9156b8752083d85b14ec31ca9e76f88a8777fa9cd451090dc9efafe44084f508fd31b1e2a0\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 32, "fields": {"name": "Comment Card", "identifier": "comment", "description": null, "enabled": true, "evaluate_function": "result['actions'] = []\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "return [] # pylint: disable=return-outside-function\n", "client_implementation": "interaction_cards/comment_i4uJGW7.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:02.871161+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"comment\",\n  \"name\": \"Comment Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"f7a960773df4e045381d7e77749d2f25da1d09fdd20c2f03d2e9dee211eb0be7d28f5c195a23761f84f6fb0bf71859babe0fed4f932ccce119c73240a0f622f1\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/comment/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/comment/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/comment/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.830469+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/comment/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/comment/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/comment/client.js\",\n      \"sha512-hash\": \"c1ab336c476582b4253506b09164ed009ffcf6636c5b1e5a6974035897eade179d2eec80df0b47d3edb85723633ecdc9d3fdf7d9877b22adbf31e83280dd89ad\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.830469+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/comment/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/comment/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/comment/client.js\",\n      \"sha512-hash\": \"0a53419d4590f204018b7fe503b987329bde88031579c03fc5e69d9fdcb7d5ccdf3e95b038797ae3006bc1d243e2e03e1afff3e25e14a45ee5be70dadf81e04e\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/comment/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/comment/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/comment/client.js\",\n      \"sha512-hash\": \"0a53419d4590f204018b7fe503b987329bde88031579c03fc5e69d9fdcb7d5ccdf3e95b038797ae3006bc1d243e2e03e1afff3e25e14a45ee5be70dadf81e04e\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 33, "fields": {"name": "Game Over Card", "identifier": "game-over", "description": null, "enabled": true, "evaluate_function": "result['next_id'] = 'dialog-end'\n", "entry_actions": "end_activity = {\n    'type': 'end-activity'\n}\n\nactions.append(end_activity)\n", "client_implementation": "interaction_cards/game-over_zcn19vj.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:03.650055+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"game-over\",\n  \"name\": \"Game Over Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"29e496def6bac38307926bab0f7891dda2e572a32733720ab74447d0ecb5e5a6586c8d26d07e47b0a32082d195f2f37c954a9c4db3941bcc6549374803f736bd\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/game_over/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/game_over/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/game_over/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.831497+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/game_over/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/game_over/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/game_over/client.js\",\n      \"sha512-hash\": \"fdb98f485855bf9d9cf646a1bdbe27c2f6926d97161b193ba6d35cefdf75a207fd8e2ab19a91cc16a62ff7a1093d3f590855b49a5a17b265dc4dd0d5490c6588\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/game_over/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/game_over/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/game_over/client.js\",\n      \"sha512-hash\": \"fdb98f485855bf9d9cf646a1bdbe27c2f6926d97161b193ba6d35cefdf75a207fd8e2ab19a91cc16a62ff7a1093d3f590855b49a5a17b265dc4dd0d5490c6588\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 34, "fields": {"name": "HTTP Request Card", "identifier": "http-request", "description": null, "enabled": true, "evaluate_function": " # pylint: disable=line-too-long\n\nimport re\nimport json\n\nimport requests\n\n# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n# {\n#    \"name\": cardName,\n#    \"patterns\": [],\n#    \"request_variables\": [],\n#    \"http_method\": \"get\",\n#    \"url\": \"http://www.example.com\",\n#    \"type\": \"http-request\",\n#    \"id\": Node.uuidv4()\n# }\n\nlogger.info('HTTP REQUEST')\nlogger.info('DEF: ' + json.dumps(definition, indent=2))\nlogger.info('EXTRAS: ' + str(extras))\n\nresult['details'] = {}\n\nresult['actions'] = []\nresult['next_id'] = None\n\npayload = {}\n\nif 'request_variables' in definition:\n    for pair in definition['request_variables']:\n        payload[pair['name']] = pair['value']\n\nresponse = None\n\nif ('timeout' in definition) is False:\n    definition['timeout'] = '30'\n\ntry:\n    if definition['http_method'] == 'post':\n        response = requests.post(definition['url'], params=payload, timeout=float(definition['timeout']))\n    else:\n        response = requests.get(definition['url'], params=payload, timeout=float(definition['timeout']))\nexcept requests.exceptions.Timeout:\n    result['next_id'] = definition['timeout_action']\n\nif response.status_code == 200:\n    for pattern_def in definition['patterns']:\n        logger.info('MATCH? %s / %s --> %s', pattern_def['pattern'], response.text, re.search(pattern_def['pattern'], response.text))\n\n        pattern = re.compile(pattern_def['pattern'], re.IGNORECASE)\n\n        if result['next_id'] is None and pattern.search(response.text) is not None:\n            result['next_id'] = pattern_def['action']\n            result['matched_pattern'] = pattern_def['pattern']\nelif response.status_code == 404:\n    result['next_id'] = definition['not_found_action']\nelif response.status_code == 500:\n    result['next_id'] = definition['server_error_action']\n\nlogger.info(u'RESPONSE TEXT: ' + str(len(response.text)))\n\nresult['details']['url'] = response.url\nresult['details']['method'] = definition['http_method']\nresult['details']['parameters'] = payload\nresult['details']['status_code'] = response.status_code\nresult['actions'] = []\n\nif result['next_id'] is None:\n    result['next_id'] = definition['not_found_action']\n", "entry_actions": "# No action needed - stuff happens in response to incoming data.\n", "client_implementation": "interaction_cards/http-request_rVoLqYE.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:04.278305+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"http-request\",\n  \"name\": \"HTTP Request Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"851c4cbcb5e6e7d59b510b22a00982bfe5f4eb0aab8cc7b6bb8814d8836d4214b03ca7983f0761d2b9180158bfc788bedd8cac5916a4930d0f4a811bb7855d4a\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/http_request/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/http_request/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/http_request/client.js\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"sha512-hash\": \"851c4cbcb5e6e7d59b510b22a00982bfe5f4eb0aab8cc7b6bb8814d8836d4214b03ca7983f0761d2b9180158bfc788bedd8cac5916a4930d0f4a811bb7855d4a\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/http_request/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/http_request/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/http_request/client.js\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 35, "fields": {"name": "Pause Card", "identifier": "pause", "description": null, "enabled": true, "evaluate_function": "import json\nimport logging\n\nimport arrow\n\n# Incoming globals: definition, response, last_transition, previous_state\n\nlogger = logging.getLogger('db')\n\nvariable = definition['id'] + '-pause-duration'\n\nvalue = extras['session'].fetch_variable(variable)\n\nif value is None or value == '':\n    logger.info('No variable set: ' + variable + '!')\n\n    extras['session'].set_variable(variable, arrow.utcnow(). isoformat())\nelse:\n    logger.info('Has variable: ' + variable + ' = ' + value)\n\n    pause_start = arrow.get(value)\n    pause_end = pause_start.shift(seconds=int(definition['duration']))\n    \n    now = arrow.get()\n    \n    if now > pause_end:\n        extras['session'].set_variable(variable, '')\n\n        result['details'] = {\n            'resumed': now.isoformat()\n        }\n\n        result['actions'] = []\n\n        result['next_id'] = definition['next']\n\n        if ('#' in result['next_id']) is False:\n            result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n    else:\n        result['actions'] = []\n\n        result['next_id'] = None\n", "entry_actions": "# No action needed - stuff happens in response to nudges.\n", "client_implementation": "interaction_cards/pause_Lh1Y0u1.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:05.174097+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"pause\",\n  \"name\": \"Pause Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial versions.\",\n      \"sha512-hash\": \"3601655039d93b4025fb6c4ce5e4cdc505ad5a53572666fe49f20d5df08ea8f73ba58541f9d5de4b77bd66abc4e7b43b5815c7975113e55171db1075fe00081b\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/pause/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/pause/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/pause/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.832077+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/pause/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/pause/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/pause/client.js\",\n      \"sha512-hash\": \"3136cce370714c64823cdf8b2ad1bf26e4f34aa6fa63e2eda1857c8056fdbd593e585f41d7d9450c9d1b1850378e8dc58ab1ce5978536a9899f651ab470a7dd9\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.832077+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/pause/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/pause/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/pause/client.js\",\n      \"sha512-hash\": \"061ddfe836e9bdaf2e9812dbbad644c97c3dcd1b8769074e269ab40832cb723b221b6ec617ad8c72a3b6a235688c665e247fc9c7d76e7e78733d6cf583dca564\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/pause/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/pause/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/pause/client.js\",\n      \"sha512-hash\": \"061ddfe836e9bdaf2e9812dbbad644c97c3dcd1b8769074e269ab40832cb723b221b6ec617ad8c72a3b6a235688c665e247fc9c7d76e7e78733d6cf583dca564\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 36, "fields": {"name": "Keyword Response (SMS)", "identifier": "process-response", "description": null, "enabled": true, "evaluate_function": "# pylint: disable=line-too-long\n\nimport datetime\nimport logging\nimport re\n\nfrom django.utils import timezone\n\n# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n#      {\n#        \"not_found_action\": \"request-consent-2\",\n#        \"name\": \"Process Consent Response\",\n#        \"patterns\": [\n#          {\n#            \"action\": \"continue-intro\",\n#            \"pattern\": \"^[Yy]\"\n#          },\n#          {\n#            \"action\": \"nonconsent-thanks-2\",\n#            \"pattern\": \"^[Nn]\"\n#          }\n#        ],\n#        \"timeout\": {\n#          \"duration\": 4,\n#          \"units\": \"hour\",\n#          \"action\": \"consent-timeout\"\n#        },\n#        \"type\": \"process-response\",\n#        \"id\": \"process-consent\"\n#      },\n\nlogger = logging.getLogger('db')\n\nresult['details'] = {}\n\nresult['actions'] = []\nresult['next_id'] = None\n\nif response is not None:\n    result['details']['response'] = response\n    result['actions'] = []\n    result['next_id'] = None\n\n    for pattern_def in definition['patterns']:\n        pattern = re.compile(pattern_def['pattern'], re.IGNORECASE)\n\n        if result['next_id'] is None and pattern.match(response) is not None:\n            result['next_id'] = pattern_def['action']\n            result['matched_pattern'] = pattern_def['pattern']\n\n    if result['next_id'] is None and definition['not_found_action'] is not None:\n        result['next_id'] = definition['not_found_action']\n        result['matched_pattern'] = 'no-matches-found'\nelif 'timeout' in definition:\n    test = timezone.now()\n\n    if 'units' in definition['timeout'] and 'duration' in definition['timeout']:\n        duration = int(definition['timeout']['duration'])\n\n        if definition['timeout']['units'] == 'second':\n            test = test - datetime.timedelta(seconds=duration)\n        elif definition['timeout']['units'] == 'minute':\n            test = test - datetime.timedelta(seconds=(duration * 60))\n        elif definition['timeout']['units'] == 'hour':\n            test = test - datetime.timedelta(seconds=(duration * 60 * 60))\n        elif definition['timeout']['units'] == 'day':\n            test = test - datetime.timedelta(days=duration)\n        else:\n            logger.info('Invalid duration = %d, and units = %s', str(duration), str(definition['timeout']['units']))\n\n    if last_transition < test:\n        result['next_id'] = definition['timeout']['action']\n    else:\n        result['next_id'] = definition['id']\n\nif result['next_id'] is not None and ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "# No action needed - stuff happens in response to incoming data.\n", "client_implementation": "interaction_cards/process-response_fkySIdi.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:05.945790+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"process-response\",\n  \"name\": \"Keyword Response (SMS)\",\n  \"versions\": [\n    {\n      \"version\": 0.4,\n      \"name\": \"0.4\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Updates human-readable card name\",\n      \"sha512-hash\": \"3a70ec072a4992088ea29a104a6fc725169d1464f0b2f1c7f1753dbf86f3f0662e51f8a452c9e89379dcb0b271099e4e625854e2e4f6f6fe55d22464e61bac9d\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.3/process_response/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.3/process_response/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.3/process_response/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.830261+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_response/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_response/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_response/client.js\",\n      \"sha512-hash\": \"8974455d747a36a796bd3a1c8a0f7f2b228a009e82a2854e738732c52e5b45c636c5a0cfdc7c63c2c59bbcf1aedd42196f4068a28a8af28604a9eb541381b439\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-04-09T15:46:30.830261+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/process_response/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/process_response/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/process_response/client.js\",\n      \"sha512-hash\": \"d8348774e53952a4c28306f2d2020d2c8ad93453494f273a8a0e843ee43c519ef45571c30aeb642bfb939ec2fe38b304036cf3d2a8e6c2c1c8b103a649b88fe1\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_response/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_response/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_response/client.js\",\n      \"sha512-hash\": \"d8348774e53952a4c28306f2d2020d2c8ad93453494f273a8a0e843ee43c519ef45571c30aeb642bfb939ec2fe38b304036cf3d2a8e6c2c1c8b103a649b88fe1\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 37, "fields": {"name": "Process Variable Card", "identifier": "process-variable", "description": null, "enabled": true, "evaluate_function": "import re\n\n# Incoming globals: definition, response, last_transition, previous_state\n\nresult['details'] = {}\n\nresult['actions'] = []\nresult['next_id'] = None\n\nvalue = extras['session'].fetch_variable(definition['variable']) # pylint: disable=invalid-name\n\nif value is None:\n    value = ''\n\nresult['details']['fetched'] = value\nresult['details']['variable'] = definition['variable']\nresult['actions'] = []\nresult['next_id'] = None\n\nfor pattern_def in definition['patterns']:\n    pattern = re.compile(pattern_def['pattern'], re.IGNORECASE)\n\n    if result['next_id'] is None and pattern.match(value) is not None:\n        result['next_id'] = pattern_def['action']\n        result['matched_pattern'] = pattern_def['pattern']\n\nif result['next_id'] is None and definition['not_found_action'] is not None:\n    result['next_id'] = definition['not_found_action']\n    result['matched_pattern'] = 'no-matches-found'\n\nif result['next_id'] is not None and ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "# No action needed - stuff happens in response to incoming data.\n", "client_implementation": "interaction_cards/process-variable_Dh0ujTW.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:06.807818+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"process-variable\",\n  \"name\": \"Process Variable Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"eb70d97cc54fec49f4f1d02c5e0661761c72ff9e790c78cf47f6508e0988103249bada4264bdb8d3e5151c4770d21c2d6bf4a4295bf4cdd29b660cafe9cf0c77\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/process_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/process_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/process_variable/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.831912+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/process_variable/client.js\",\n      \"sha512-hash\": \"eb70d97cc54fec49f4f1d02c5e0661761c72ff9e790c78cf47f6508e0988103249bada4264bdb8d3e5151c4770d21c2d6bf4a4295bf4cdd29b660cafe9cf0c77\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/process_variable/client.js\",\n      \"sha512-hash\": \"eb70d97cc54fec49f4f1d02c5e0661761c72ff9e790c78cf47f6508e0988103249bada4264bdb8d3e5151c4770d21c2d6bf4a4295bf4cdd29b660cafe9cf0c77\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 38, "fields": {"name": "Response Contains Image Card", "identifier": "response-contains-image", "description": null, "enabled": true, "evaluate_function": "# pylint: disable=line-too-long\r\n\r\n# Definition Example\r\n#      {\r\n#        \"has_image_action\": \"request-consent-2\",\r\n#        \"no_image_action\": \"request-consent-2\",\r\n#        \"name\": \"Process Consent Response\",\r\n#        \"type\": \"response-contains-image\",\r\n#        \"id\": \"response-contains-image\"\r\n#      },\r\n\r\nresult['details'] = {}\r\n\r\nresult['actions'] = []\r\nresult['next_id'] = None\r\n\r\nif 'extras' in extras:\r\n    if extras['extras'] is not None and 'last_message' in extras['extras']:\r\n        if extras['extras']['last_message'] is not None:\r\n            image_count = extras['extras']['last_message'].media.filter(content_type__startswith='image/').count()\r\n\r\n            if image_count > 0:\r\n                result['next_id'] = definition['has_image_action']\r\n\r\nif result['next_id'] is None:\r\n    result['next_id'] = definition['no_image_action']\r\n\r\nif result['next_id'] is not None and ('#' in result['next_id']) is False:\r\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\r\n\r\nif 'extras' in extras and extras['extras'] is None:\r\n    result['next_id'] = None\r\n", "entry_actions": "# No action needed - stuff happens in response to incoming data.\n", "client_implementation": "interaction_cards/response-contains-image_bHHanDx.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:07.647808+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"response-contains-image\",\n  \"name\": \"Response Contains Image Card\",\n  \"versions\": [\n    {\n      \"version\": 0.2,\n      \"name\": \"0.2\",\n      \"created\": \"2020-12-05T00:00:00.000000+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"29f0fc9f8931a8b39ad7d79789bf4c457692307cc3e9052f7fd270796313ac8ac11acae71134a2867f3b885b624e4f724ebca07b19711b0f380cc89e89f3e972\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.2/response_contains_image/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.2/response_contains_image/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.2/response_contains_image/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.831094+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/response_contains_image/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/response_contains_image/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/response_contains_image/client.js\",\n      \"sha512-hash\": \"e154872bd2ecc5f5d41385fe819ebb20e6f60a1722354ce42c68dc1cde2264790342d8e3e6b222d655222c4fb668bb7af9423fe67af6d6f3c9af4faf17726274\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.831094+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/response_contains_image/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/response_contains_image/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/response_contains_image/client.js\",\n      \"sha512-hash\": \"cdced2ad3b06fcc71f511de825d020fae6fd8e02a00a4504ed0d7215428ff2f2726825d1f216c6286dac8bebd1d05d46dfe1ba3ce6d0fdec6cee9346330c48b9\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/response_contains_image/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/response_contains_image/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/response_contains_image/client.js\",\n      \"sha512-hash\": \"cdced2ad3b06fcc71f511de825d020fae6fd8e02a00a4504ed0d7215428ff2f2726825d1f216c6286dac8bebd1d05d46dfe1ba3ce6d0fdec6cee9346330c48b9\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 39, "fields": {"name": "Send Message Card", "identifier": "send-message", "description": null, "enabled": true, "evaluate_function": "# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n#      {\n#        \"message\": \"Are you ready to proceed? (Respond Y to continue.)\",\n#        \"next\": \"process-consent\",\n#        \"type\": \"send-message\",\n#        \"id\": \"request-consent-2\",\n#        \"name\": \"Request Consent\"\n#      },\n#\n# Must populate:\n#   result = {\n#       'details': {},\n#       'actions': [],\n#       'next_id': None\n#   }\n\nresult['details'] = {\n    'message': definition['message']\n}\n\nresult['actions'] = []\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "actions.append({\n    'type': 'echo',\n    'message': definition['message']\n})\n", "client_implementation": "interaction_cards/send-message_1K4jPPi.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:08.295817+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"send-message\",\n  \"name\": \"Send Message Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"993379fb12bc80c98b2e2b4ad5766c1101cc744638812dc26269e7d64d267506e6e151d88fd848b1c9fc3ae3f1022d9582451eb1a02221817f2a51bedc093e3c\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_message/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.829816+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_message/client.js\",\n      \"sha512-hash\": \"c14998a26807ce54c8867c6bb26ba5278312b4da5d6fc00bf13e7fa6488dae05a18503eaccf875071476f379e363faf9183ed2954ffb68140a5b8337a87fca2a\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_message/client.js\",\n      \"sha512-hash\": \"c14998a26807ce54c8867c6bb26ba5278312b4da5d6fc00bf13e7fa6488dae05a18503eaccf875071476f379e363faf9183ed2954ffb68140a5b8337a87fca2a\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 40, "fields": {"name": "Send Picture Card", "identifier": "send-picture", "description": null, "enabled": true, "evaluate_function": "# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n#      {\n#        \"image\": \"https://upload.wikimedia.org/wikipedia/commons/5/54/Welcome_sign_at_Wrigley.jpg\",\n#        \"type\": \"send-picture\",\n#        \"id\": \"wrigley-sign-example\",\n#        \"name\": \"Show Sign Example\",\n#        \"next\": \"instruction-3\"\n#      },\n#\n# Must populate:\n#   result = {\n#       'details': {},\n#       'actions': [],\n#       'next_id': None\n#   }\n\nresult['details'] = {\n    'image-url': definition['image']\n}\n\nresult['actions'] = []\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "actions.append({\n    'type': 'echo-image',\n    'image-url': definition['image']\n})\n", "client_implementation": "interaction_cards/send-picture_IhaElHC.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:08.915316+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"send-picture\",\n  \"name\": \"Send Picture Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"62457162f7991a769becf1dbd2e597c86facf26bcf386fa6eff3fb90e23ea51e604656c66e730a923dc1e03ab9c0efe01a7c47a7e830e4e4a71b59bec79a21da\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_picture/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_picture/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/send_picture/client.js\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.831792+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_picture/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_picture/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/send_picture/client.js\",\n      \"sha512-hash\": \"328456a18cdb7b4843c68cdcbb453e336fcf66cdf20587b76acca9d4587e32321ab530931098ee0dd508a80a0da66cbf6ccc0340389733cc9a3b3480c70ef9c2\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.831792+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/send_picture/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/send_picture/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/send_picture/client.js\",\n      \"sha512-hash\": \"640b2d4bfa6f7ea264475bc550cbd3fdd93f2ab9ab31d8f523b16bc4ceb25ee0ed1bc86c3b39fc0e2cf8b3c6e352d2c24483d5461ad4501bfeae91aa7fa9f733\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_picture/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_picture/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/send_picture/client.js\",\n      \"sha512-hash\": \"640b2d4bfa6f7ea264475bc550cbd3fdd93f2ab9ab31d8f523b16bc4ceb25ee0ed1bc86c3b39fc0e2cf8b3c6e352d2c24483d5461ad4501bfeae91aa7fa9f733\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 41, "fields": {"name": "Set Variable Card", "identifier": "set-variable", "description": null, "enabled": true, "evaluate_function": "# Incoming globals: definition, response, last_transition, previous_state\n\nresult['details'] = {\n    'name': definition['variable'],\n    'value': definition['value'],\n}\n\nif 'scope' in definition:\n    result['scope'] = definition['scope']\n\nresult['actions'] = []\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "variable = {\n    'type': 'set-variable',\n    'name': definition['name'],\n    'variable': definition['variable'],\n    'value': definition['value']\n}\n\nif 'scope' in definition:\n    variable['scope'] = definition['scope']\n\nactions.append(variable)\n", "client_implementation": "interaction_cards/set-variable_t9fw9aR.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:09.773555+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"set-variable\",\n  \"name\": \"Set Variable Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/set_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/set_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/set_variable/client.js\",\n      \"sha512-hash\": \"f7dd3e4ae6dc043636a6876e45e89994c57a0a98f4115951633d178862614819703d81fb723e0a8c97bdba610834e883553a9cb1d4df9057fd3e36395b381f85\"\n    },\n    {\n      \"version\": 0.5,\n      \"name\": \"0.5\",\n      \"created\": \"2021-04-09T15:46:30.831238+00:00\",\n      \"notes\": \"Uses declarative definitions.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/set_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/set_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.5/set_variable/client.js\",\n      \"sha512-hash\": \"3bc622e868b7326da6a4d502839275637d3d04f40e78184680ecd88de8c1a5a0cd45a07160cd5b18badbfed69e2163fd50e40dda78d03fc6d9fb2b0ee51c1bed\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T15:46:30.831238+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/set_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/set_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/set_variable/client.js\",\n      \"sha512-hash\": \"4e85d46a4cb74b209a1ff9e6cdedb6b80b5d6a63e8ea8f5efc25b78b9e437ad12ecf4d334d12ae468d39765c92b6a0640f1549c73da2bf762dc02d2a1772db3f\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/set_variable/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/set_variable/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/set_variable/client.js\",\n      \"sha512-hash\": \"4e85d46a4cb74b209a1ff9e6cdedb6b80b5d6a63e8ea8f5efc25b78b9e437ad12ecf4d334d12ae468d39765c92b6a0640f1549c73da2bf762dc02d2a1772db3f\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 42, "fields": {"name": "Voice Message Card", "identifier": "voice-message", "description": null, "enabled": true, "evaluate_function": "# Incoming globals: definition, response, last_transition, previous_state\n\n# Definition Example\n#      {\n#        \"message\": \"Are you ready to proceed? (Respond Y to continue.)\",\n#        \"next\": \"process-consent\",\n#        \"type\": \"send-message\",\n#        \"id\": \"request-consent-2\",\n#        \"name\": \"Request Consent\"\n#      },\n#\n# Must populate:\n#   result = {\n#       'details': {},\n#       'actions': [],\n#       'next_id': None\n#   }\n\nresult['details'] = {\n    'message': definition['message']\n}\n\nresult['actions'] = []\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "actions.append({\n    'type': 'echo-voice',\n    'message': definition['message'],\n    'next_action': definition['next_action']\n})\n", "client_implementation": "interaction_cards/voice-message_hFlAZlb.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:10.440520+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"voice-message\",\n  \"name\": \"Voice Message Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2020-11-06T18:11:51.987813+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"a1b8ebb5d0f0a722f9f10fcc7a55de4864f7d6c23d4a539f36e0606c77fc50ccd7a49e679d89398840183452c6789fd5ead2cf46d0aea5b07ae48e3e5df82a99\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/voice_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/voice_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.1/voice_message/client.js\"\n    },\n    {\n      \"version\": 0.6,\n      \"name\": \"0.6\",\n      \"created\": \"2021-06-28T12:00:00.000000+00:00\",\n      \"notes\": \"Updates user interface to use updated Material Design library\",\n      \"sha512-hash\": \"0a31dbd1d86dedd855734ae549157d70ae123b9ee77e15cffb1d0a0bdafcf7f9765fe77518746317dd11b8796d4046e0e6d32df1ecf4deffbcd6a3396ad41917\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.6/voice_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.6/voice_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.6/voice_message/client.js\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"sha512-hash\": \"0a31dbd1d86dedd855734ae549157d70ae123b9ee77e15cffb1d0a0bdafcf7f9765fe77518746317dd11b8796d4046e0e6d32df1ecf4deffbcd6a3396ad41917\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/voice_message/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/voice_message/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/voice_message/client.js\"\n    }\n  ]\n}", "version": 0.9}}, {"model": "builder.interactioncard", "pk": 43, "fields": {"name": "Data Query Card", "identifier": "data-query", "description": null, "enabled": true, "evaluate_function": "import datetime\nimport json\nimport logging\nimport re\n\nfrom django.utils.encoding import smart_str\n\nfrom builder.models import DataProcessor\n\nlogger = logging.getLogger('db')\n\nresult['details'] = {\n    'data-processor': definition['processor']\n}\n\nresult['actions'] = []\n\nprocessor = DataProcessor.objects.filter(identifier=definition['processor']).first()\n\nif processor is not None:\n    context = None\n\n    if definition['scope'] == 'session':\n        context = extras['session'].fetch_session_context()\n    elif definition['scope'] == 'player':\n        context = extras['session'].fetch_player_context()\n    elif definition['scope'] == 'game':\n        context = extras['session'].fetch_game_context()\n\n    if context is None:\n        logger.info('Unable to fetch appropriate context: %s', definition['scope'])\n    else:\n        original_context = context.copy()\n\n        code = compile(smart_str(processor.processor_function), '<string>', 'exec')\n\n        local_env = {\n            'metadata': json.loads(processor.metadata),\n            'context': context\n        }\n\n        eval(code, {}, local_env) # nosec # pylint: disable=eval-used\n\n        for key in context:\n            if key in original_context and context[key] == original_context[key]:\n                pass # No change - do nothing\n            else:\n                variable = {\n                    'type': 'set-variable',\n                    'name': definition['name'],\n                    'variable': key,\n                    'value': context[key]\n                }\n\n                if 'scope' in definition:\n                    variable['scope'] = definition['scope']\n\n                result['actions'].append(variable)\nelse:\n    logger.info('Unable to locate DataProcessor: %s', definition['processor'])\n\nresult['next_id'] = definition['next']\n\nif ('#' in result['next_id']) is False:\n    result['next_id'] = definition['sequence_id'] + '#' + result['next_id']\n", "entry_actions": "# Make API call with appropriate context...", "client_implementation": "interaction_cards/data-query_k6ekavo.js", "metadata": "{\n  \"updated\": \"2021-08-24T00:55:11.092041+00:00\"\n}", "repository_definition": "{\n  \"identifier\": \"data-query\",\n  \"name\": \"Data Query Card\",\n  \"versions\": [\n    {\n      \"version\": 0.1,\n      \"name\": \"0.1\",\n      \"created\": \"2021-06-28T12:00:00.000000+00:00\",\n      \"notes\": \"Initial version.\",\n      \"sha512-hash\": \"798170a914d641f1f8a21535d13bba265c5a8c11e1f7b525e7766fbfe41a6cad4d87af76174fd5a4bfcbfeda0b7e4b5109aa9ab904157447bb1fed7eb758f9e8\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.7/data_query/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.7/data_query/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.7/data_query/client.js\"\n    },\n    {\n      \"version\": 0.8,\n      \"name\": \"0.8\",\n      \"created\": \"2021-06-28T13:00:00.000000+00:00\",\n      \"notes\": \"Code cleanup.\",\n      \"sha512-hash\": \"a275dea1c0e89b51c8be2f02c120f1dd9fd7da95a9ab30e10ff74ff925fdd769537592d7cc2e2a495d6f8d713f4f6f471eb3b52f72aba52b045fcddb2bb9ef72\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/data_query/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/data_query/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.8/data_query/client.js\"\n    },\n    {\n      \"version\": 0.9,\n      \"name\": \"0.9\",\n      \"created\": \"2021-07-16T12:00:00.000000+00:00\",\n      \"notes\": \"Repository reorganization\",\n      \"sha512-hash\": \"a275dea1c0e89b51c8be2f02c120f1dd9fd7da95a9ab30e10ff74ff925fdd769537592d7cc2e2a495d6f8d713f4f6f471eb3b52f72aba52b045fcddb2bb9ef72\",\n      \"entry-actions\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/data_query/entry.py\",\n      \"evaluate-function\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/data_query/evaluate.py\",\n      \"client-implementation\": \"https://raw.githubusercontent.com/audacious-software/Hive-Mechanic-Interaction-Cards/0.9/cards/data_query/client.js\"\n    }\n  ]\n}", "version": 0.9}}]